var server = require("./server");

var http = require('http');
var Filter = require('./DoFilter');
var Router = require('./Router');
function onRequest(request,response){
	console.log("Begin..................");
//	Filter.doFilter(request,response);
	var stack = [];
	
	var middlewareStack = stack.concat(Filter.getFilterList()).concat(Router);

	var next = function(){
		var middleware = middlewareStack.shift();
		if(middleware && middleware.doFilter){
			middleware.doFilter(request,response,next);
		}
		return middlewareStack;
	}
	next();
	//next().push(Router);
	//next();

	console.log("End..................")
}

var createServer = {
	listen:function(port){
		require("./Initilaze").init();
		http.createServer(onRequest).listen(port);
	}
}

exports.createServer = function(){
	return createServer;
}
