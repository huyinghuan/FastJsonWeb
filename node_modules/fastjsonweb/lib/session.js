var Cookie = require('./cookie');
var sessionData = require('./static_session');
function Session(request,response){
	cookie = new Cookie(request,response);
	this.sid = cookie.getSessionId();
	this.date = (function(sid){
		temp = sessionData.data[sid];
		if(!temp){ //如果session数据不存在
			temp = {values:{},time:new Date().getTime()};
			sessionData.data[sid] = temp;
			cookie.setSessionId(sid);
			cookie.flush();
		}
		return temp.values;
	})(this.sid);
	/**
	date = {
		sid:{
			values:{key:value,key1:value},
			time: 1000000000000,
		},
		sid2:{
			...
		}	
	}
	*/
	this.getValue  = function(name){
		return this.date[name];
	}
	this.setValue = function(name,value){
		this.date[name] = value;
		sessionData.data[this.sid]["values"] =  this.date;
	}
	
}
module.exports = Session;