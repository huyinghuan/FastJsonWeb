/**
  静态资源管理
  需改善：文件类型列表 
**/
var url = require('url');
var path = require('path');  
var fs = require('fs');
var mime = require('./mime').getMime();
function Assets(){
	this.execute = function(request,response){
	    var uri =  url.parse(request.url).pathname;
	    var filePath = path.join(process.cwd(),uri);
	    var exists = fs.existsSync(filePath);

		if(!exists){
			response.writeHead(404,{"Content-Type":"text/plain"});
			response.write("404,"+uri+"not exists");
			response.end();
			return;
		}
		//文件类型判断 是否访问的是文件夹
		var ext = path.extname(filePath);
		if(ext === ""){
			response.writeHead(403,{"Content-Type":"text/plain"});
			response.write(uri+" is forbidden","UTF-8"); 
			response.end();
			return;
		}
		ext = ext ? ext.slice(1).toLocaleUpperCase() :'unkown';
		var contentType=mime[ext] || "text/plain";
		var fileStream = fs.createReadStream(filePath);
		response.setHeader("Content-Disposition", "inline;");
		response.writeHead(200, {"Content-Type": contentType});
		fileStream.pipe(response);
		fileStream.on("end", function() {
			response.end();
		})
	};
}
module.exports = Assets;
