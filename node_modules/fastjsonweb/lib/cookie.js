var UUID = require("./uuid");
function Cookie(req,res){
	//解析cookie数据
	this.Cookies = (function(){
		var arr= [];
		var obj = {};
		if(req.headers.cookie){
			arr = req.headers.cookie.split(";");
		}
		for(index in arr){
			var parts = arr[index].split('=');
			obj[parts[0].trim()] = (parts[1]||'').trim();
		}
		return obj;
	})();
	//获取cookie
	this.getValue = function(key){
		return this.Cookies ? (this.Cookies[key]||undefined) : undefined;
	};
	//设置Cookie
	this.setValue= function(key,value){
		if(typeof(value) !== "string"){
			value = JSON.stringify(value);
		}
		this.Cookies[key] = value;
	};
	//设置获取sid
	this.getSessionId= function(){
		return this.Cookies["sid"] || UUID.getUUID();//不存在sid则自动生成一个
	},
	this.setSessionId= function(sid){
		this.Cookies["sid"] = sid;
	}
	//写入输出流
	this.flush = function(){
		var arr = [];
		for(key in this.Cookies){
			arr.push(key+"="+this.Cookies[key]);
		}
		res.setHeader('Set-Cookie',arr);
	}
}
module.exports = Cookie;